<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.study.springboard.repositories.BoardMapper">

    <select id="findAll" resultType="BoardResponseDto">
        SELECT b.board_id, b.writer, b.title,b.views,
               b.created_at, b.modified_at, c.category_name
        FROM board AS b
            JOIN category AS c ON b.category_id = c.category_id
        <where>
            <if test="startDate != null and startDate != ''">
                <![CDATA[
                AND b.created_at >= #{startDate}
                ]]>
            </if>
            <if test="endDate != null and endDate != ''">
                <![CDATA[
                AND b.created_at <= #{endDate}
                ]]>
            </if>
            <if test="categoryId != null and categoryId != ''
            and categoryId != 'ALL'">
                AND b.category_id = #{categoryId}
            </if>
            <if test="keyword != null and keyword != ''">
                AND (
                    b.writer LIKE CONCAT('%', #{keyword}, '%') OR
                    b.title LIKE CONCAT('%', #{keyword}, '%') OR
                    b.content LIKE CONCAT('%', #{keyword}, '%')
                    )
            </if>
        </where>
        ORDER BY b.board_id DESC;
    </select>

    <select id="findBoardCount" resultType="java.lang.Integer">
        SELECT COUNT(*) as totalBoardCount
        FROM board AS b
            JOIN category AS c ON b.category_id = c.category_id
        <where>
            <if test="startDate != null and startDate != ''">
                <![CDATA[
                AND b.created_at >= #{startDate}
                ]]>
            </if>
            <if test="endDate != null and endDate != ''">
                <![CDATA[
                AND b.created_at <= #{endDate}
                ]]>
            </if>
            <if test="categoryId != null and categoryId != ''
            and categoryId != 'ALL'">
                AND b.category_id = #{categoryId}
            </if>
            <if test="keyword != null and keyword != ''">
                AND (
                b.writer LIKE CONCAT('%', #{keyword}, '%') OR
                b.title LIKE CONCAT('%', #{keyword}, '%') OR
                b.content LIKE CONCAT('%', #{keyword}, '%')
                )
            </if>
        </where>
    </select>
</mapper>
